# 기사점수파일 전처리 스파크 코드





## 파일불러오기

```python
hdfs dfs -put ./BeautifulAnts/Article/ALTRIA_scda.csv ALTRIA.csv
hdfs dfs -put ./BeautifulAnts/Article/Amazon_scda.csv Amazon.csv
hdfs dfs -put ./BeautifulAnts/Article/AMD_scda.csv AMD.csv
hdfs dfs -put ./BeautifulAnts/Article/Coca-cola_scda.csv Cocacola.csv
hdfs dfs -put ./BeautifulAnts/Article/Facebook_scda.csv Facebook.csv
hdfs dfs -put ./BeautifulAnts/Article/Microsoft_scda.csv Microsoft.csv
hdfs dfs -put ./BeautifulAnts/Article/NIKE_scda.csv NIKE.csv
hdfs dfs -put ./BeautifulAnts/Article/PFIZER_scda.csv PFIZER.csv
hdfs dfs -put ./BeautifulAnts/Article/Spotify_scda.csv Spotify.csv
hdfs dfs -put ./BeautifulAnts/Article/TESLA_scda.csv TESLA.csv
hdfs dfs -put ./BeautifulAnts/Article/Walmart_scda.csv Walmart.csv


ticker = ['ALTRIA','Amazon','AMD','Cocacola','Facebook','Microsoft', 'NIKE', 'PFIZER', 'Spotify', 'TESLA', 'Walmart']
from pyspark.sql.functions import to_timestamp
from pyspark.sql.functions import *

# 날짜 형식
months = [("201907",),("201908",),("201909",),("201910",),("201911",),("201912",),("202001",),("202002",),("202003",),("202004",),("202005",),("202006",),("202007",),("202008",),("202009",),("202010",),("202011",),("202012",),("202101",),("202102",),("202103",),("202104",),("202105",),("202106",),("202107",),("202108",),("202109",)]    
df = spark.createDataFrame(months).toDF("date")
df = df.withColumn("date", to_date(col("date"), "yyyyMM"))
    

for company in ticker :
    # 파일 불러오기
    globals()['{}_at'.format(company)] = spark.read.format('csv').option('header','true').load('{}.csv'.format(company))
    # 점수 계산해서 컬럼추가
    globals()['{}_at'.format(company)] =globals()['{}_at'.format(company)].withColumn('sent',(globals()['{}_at'.format(company)].npos - globals()['{}_at'.format(company)].nneg) / globals()['{}_at'.format(company)].nwords)
    # 점수 계산 NULL값 0으로 변경
    globals()['{}_at'.format(company)] = globals()['{}_at'.format(company)].fillna(0)
    # _co, nwords, npos, nneg 컬럼 제거
    globals()['{}_at'.format(company)] = globals()['{}_at'.format(company)].drop('nwords', 'npos', 'nneg')
    
    # 날짜 슬라이싱
    globals()['{}_at'.format(company)] = globals()['{}_at'.format(company)].withColumn("date", substring(col("date"), 4,6))
    
    # groupby
    globals()['{}_at'.format(company)] = globals()['{}_at'.format(company)].groupBy("date").mean("sent").sort("date")
    # 위에 코드 groupby하면 date가 뒤죽박죽되서 해결해야함
 	#

```

